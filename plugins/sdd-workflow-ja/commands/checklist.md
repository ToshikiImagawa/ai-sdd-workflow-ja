---
description: "仕様書・設計書から構造化されたIDとカテゴリ別の品質チェックリストを自動生成する"
allowed-tools: Read, Write, Edit, Glob, Grep
---

# Checklist - 品質チェックリスト生成

仕様書、設計書、タスク分解から包括的な品質保証チェックリストを自動生成します。

## 前提条件

**実行前に必ず `sdd-workflow-ja:sdd-workflow` エージェントの内容を読み込み、AI-SDDの原則を理解してください。**

このコマンドはsdd-workflowエージェントの原則に従って品質保証を実施します。

### ディレクトリパスの解決

**環境変数 `SDD_*` を使用してディレクトリパスを解決します。**

| 環境変数                     | デフォルト値               | 説明              |
|:-------------------------|:---------------------|:----------------|
| `SDD_ROOT`               | `.sdd`               | ルートディレクトリ       |
| `SDD_REQUIREMENT_PATH`   | `.sdd/requirement`   | PRD/要求仕様書ディレクトリ |
| `SDD_SPECIFICATION_PATH` | `.sdd/specification` | 仕様書・設計書ディレクトリ   |
| `SDD_TASK_PATH`          | `.sdd/task`          | タスクログディレクトリ     |

**パス解決の優先順位:**

1. 環境変数 `SDD_*` が設定されている場合はそれを使用
2. 環境変数がない場合は `.sdd-config.json` を確認
3. どちらもない場合はデフォルト値を使用

以下のドキュメントでは、デフォルト値を使用して説明しますが、環境変数または設定ファイルが存在する場合はカスタム値に置き換えてください。

## 入力

$ARGUMENTS

### 入力形式

```
/checklist {機能名} {チケット番号}
/checklist {機能名}  # 機能名をチケットディレクトリとして使用
```

### 入力例

```
/checklist user-auth TICKET-123
/checklist task-management
/checklist auth/user-login TICKET-789  # 階層構造
```

## 処理フロー

### 1. ソースドキュメントの読み込み

フラット構造と階層構造の両方をサポートします。

**フラット構造の場合**:

```
.sdd/requirement/{機能名}.md を読み込む（PRD、存在する場合）
.sdd/specification/{機能名}_spec.md を読み込む（必須）
.sdd/specification/{機能名}_design.md を読み込む（必須）
.sdd/task/{チケット番号}/tasks.md を読み込む（存在する場合）
```

**階層構造の場合**（引数に `/` が含まれる場合）:

```
.sdd/requirement/{親機能名}/index.md を読み込む（親機能のPRD、存在する場合）
.sdd/requirement/{親機能名}/{機能名}.md を読み込む（子機能のPRD、存在する場合）
.sdd/specification/{親機能名}/index_spec.md を読み込む（親機能のspec、存在する場合）
.sdd/specification/{親機能名}/{機能名}_spec.md を読み込む（子機能のspec、必須）
.sdd/specification/{親機能名}/index_design.md を読み込む（親機能のdesign、存在する場合）
.sdd/specification/{親機能名}/{機能名}_design.md を読み込む（子機能のdesign、必須）
.sdd/task/{チケット番号}/tasks.md を読み込む（存在する場合）
```

**⚠️ 命名規則の違いに注意**:

- **requirement 配下**: サフィックスなし（`index.md`, `{機能名}.md`）
- **specification 配下**: `_spec` または `_design` サフィックス必須（`index_spec.md`, `{機能名}_spec.md`）

### 2. 検証ポイントの抽出

各ドキュメントから、チェック可能な項目を抽出します：

**PRDから**（存在する場合）:

| 抽出項目                 | 目的         |
|:---------------------|:-----------|
| 機能要件（FR-xxx）          | 機能の完全性を検証  |
| 非機能要件（NFR-xxx）        | 品質属性を検証    |
| 受け入れ基準               | ビジネス価値を検証  |

**抽象仕様書から**:

| 抽出項目    | 目的               |
|:--------|:-----------------|
| 公開API   | インターフェース実装を検証    |
| データモデル  | 型定義を検証           |
| 振る舞い契約  | シーケンスフローを検証      |
| 制約事項    | エッジケースのハンドリングを検証 |

**技術設計書から**:

| 抽出項目     | 目的             |
|:---------|:---------------|
| モジュール構造  | アーキテクチャの整合性を検証 |
| 技術スタック   | 依存関係を検証        |
| 設計判断     | 根拠の文書化を検証      |
| 統合ポイント   | 外部接続を検証        |

**タスク分解から**（存在する場合）:

| 抽出項目     | 目的           |
|:---------|:-------------|
| 完了基準     | タスクレベルの受け入れを検証 |
| 依存関係     | 実装順序を検証      |
| テスト要件    | テストカバレッジを検証  |

### 3. チェックリスト項目の生成

抽出したポイントを実行可能なチェックリスト項目に変換します：

**ID割り当て形式**: `CHK-{カテゴリ}{nn}`

```
CHK-101, CHK-102, ... (カテゴリ 1)
CHK-201, CHK-202, ... (カテゴリ 2)
CHK-301, CHK-302, ... (カテゴリ 3)
```

| カテゴリ番号 | カテゴリ名   |
|:-------|:--------|
| 1      | 要件レビュー  |
| 2      | 仕様レビュー  |
| 3      | 設計レビュー  |
| 4      | 実装レビュー  |
| 5      | テストレビュー |
| 6      | ドキュメントレビュー |
| 7      | セキュリティレビュー |
| 8      | パフォーマンスレビュー |
| 9      | デプロイレビュー |

**カテゴリ**:

| カテゴリ        | 目的         | 例                   |
|:------------|:-----------|:--------------------|
| **要件レビュー**  | すべての要件が対応されているか検証 | FR-xxxカバレッジ、NFR-xxx検証 |
| **仕様レビュー**  | 仕様の完全性を検証  | APIシグネチャ、データモデル     |
| **設計レビュー**  | 設計品質を検証    | アーキテクチャパターン、技術スタック |
| **実装レビュー**  | コード品質を検証   | コード構造、命名規則         |
| **テストレビュー** | テストの妥当性を検証 | ユニットテスト、統合テスト、エッジケース |
| **ドキュメントレビュー** | ドキュメントを検証  | コードコメント、設計書、README |
| **セキュリティレビュー** | セキュリティ対策を検証 | 認証、認可、データ検証        |
| **パフォーマンスレビュー** | パフォーマンスを検証 | レスポンスタイム、リソース使用量   |
| **デプロイレビュー** | デプロイ準備状況を検証 | 設定、マイグレーション、ロールバック計画 |

### 4. 優先度別の整理

優先度レベルを割り当てます：

| 優先度       | マーク | 基準            | チェック時期   |
|:----------|:----|:--------------|:---------|
| **P1 - 高** | 🔴  | マージ前に必須       | PR作成前    |
| **P2 - 中** | 🟡  | マージ前に実施すべき    | PRレビュー中  |
| **P3 - 低** | 🟢  | あればよい         | 機会があれば   |

## 出力フォーマット

### チェックリストドキュメント

````markdown
# 品質チェックリスト: {機能名}

## メタ情報

| 項目 | 内容 |
|:---|:---|
| 機能名 | {機能名} |
| チケット番号 | {チケット番号} |
| 仕様書 | `.sdd/specification/[{path}/]{feature}_spec.md` |
| 設計書 | `.sdd/specification/[{path}/]{feature}_design.md` |
| 生成日 | YYYY-MM-DD |
| チェックリストバージョン | 1.0 |

※ 階層構造の場合、親機能は `index_spec.md`、`index_design.md`

## チェックリストサマリー

| カテゴリ | 総項目数 | P1 🔴 | P2 🟡 | P3 🟢 |
|:---|:---|:---|:---|:---|
| 要件レビュー | 5 | 3 | 2 | 0 |
| 仕様レビュー | 8 | 5 | 3 | 0 |
| 設計レビュー | 6 | 2 | 3 | 1 |
| 実装レビュー | 12 | 4 | 5 | 3 |
| テストレビュー | 10 | 6 | 4 | 0 |
| ドキュメントレビュー | 4 | 0 | 2 | 2 |
| セキュリティレビュー | 5 | 5 | 0 | 0 |
| パフォーマンスレビュー | 3 | 0 | 2 | 1 |
| デプロイレビュー | 7 | 4 | 3 | 0 |
| **合計** | **60** | **29** | **24** | **7** |

---

## 要件レビュー

### CHK-101 [P1] 🔴 機能要件カバレッジ

- [ ] PRDのすべての機能要件（FR-xxx）が実装されている
- [ ] 各要件が特定の実装にマッピングされている
- [ ] 部分的な実装がない

**検証方法**:
- PRDをレビュー: `.sdd/requirement/[{path}/]{feature}.md`
- 実装カバレッジを確認
- `/check_spec {機能名}` で整合性を検証

**関連要件**: FR-001, FR-002, FR-003

---

### CHK-102 [P1] 🔴 非機能要件

- [ ] パフォーマンス要件（NFR-xxx）を満たしている
- [ ] セキュリティ要件が実装されている
- [ ] スケーラビリティ要件が対応されている

**検証方法**:
- NFR仕様をレビュー
- パフォーマンステストを実行
- セキュリティ監査結果をレビュー

**関連要件**: NFR-001（レスポンスタイム < 200ms）、NFR-002（レート制限）

---

### CHK-103 [P2] 🟡 受け入れ基準

- [ ] PRDのすべての受け入れ基準を満たしている
- [ ] PRDで特定されたエッジケースがハンドリングされている
- [ ] ユーザーシナリオが検証されている

**検証方法**:
- エンドツーエンドテストを実行
- 手動ユーザーフローテスト
- ステークホルダーデモ

---

## 仕様レビュー

### CHK-201 [P1] 🔴 公開API実装

- [ ] `*_spec.md` で定義されたすべてのAPIが実装されている
- [ ] APIシグネチャが仕様と完全に一致している
- [ ] 戻り値の型が仕様と一致している

**検証方法**:
```bash
# TypeScriptの例
grep -r "export function" src/ | 仕様と比較
```

**参照**: `.sdd/specification/[{path}/]{feature}_spec.md` § 公開API

---

### CHK-202 [P1] 🔴 データモデルの整合性

- [ ] 型定義が仕様と一致している
- [ ] 必須フィールドが強制されている
- [ ] オプションフィールドが適切にハンドリングされている
- [ ] フィールド制約が検証されている

**検証方法**:
- 実装の型と仕様の型を比較
- データベーススキーマが仕様と一致するか確認
- バリデーションロジックを検証

**参照**: `.sdd/specification/[{path}/]{feature}_spec.md` § データモデル

---

### CHK-203 [P1] 🔴 振る舞いの整合性

- [ ] 仕様のシーケンス図に従っている
- [ ] 状態遷移が仕様と一致している
- [ ] エラーハンドリングが仕様のパターンに従っている

**検証方法**:
- コード実行フローをトレース
- シーケンス図と比較
- エラーシナリオをテスト

---

### CHK-204 [P2] 🟡 制約の実施

- [ ] 仕様のすべての制約が実装されている
- [ ] 境界条件がハンドリングされている
- [ ] 無効な入力が適切に拒否されている

**検証方法**:
- 制約テストをレビュー
- 境界値をテスト
- 無効な入力をテスト

---

## 設計レビュー

### CHK-301 [P1] 🔴 アーキテクチャの整合性

- [ ] モジュール構造が設計書と一致している
- [ ] レイヤー分離が維持されている
- [ ] 依存関係が正しい方向に流れている

**検証方法**:
- ディレクトリ構造を設計書と比較
- import文をレビュー
- 循環依存をチェック

**参照**: `.sdd/specification/[{path}/]{feature}_design.md` § アーキテクチャ

---

### CHK-302 [P1] 🔴 技術スタックの準拠

- [ ] 指定されたすべてのライブラリが使用されている
- [ ] 未承認の依存関係が追加されていない
- [ ] バージョン制約に従っている

**検証方法**:
```bash
# package.jsonを設計書と比較
cat package.json | grep dependencies
```

**参照**: `.sdd/specification/[{path}/]{feature}_design.md` § 技術スタック

---

### CHK-303 [P2] 🟡 設計判断の文書化

- [ ] すべての重要な設計判断が文書化されている
- [ ] 判断の根拠が明確である
- [ ] トレードオフが説明されている
- [ ] 検討した代替案が記載されている

**検証方法**:
- 設計書の「設計判断」セクションをレビュー
- 最近の更新を確認
- 判断が実装と一致するか検証

---

### CHK-304 [P2] 🟡 統合ポイントの検証

- [ ] 外部API統合がテストされている
- [ ] データベース接続が設定されている
- [ ] メッセージキュー接続が動作している
- [ ] サードパーティサービス統合が検証されている

**検証方法**:
- 統合テストを実行
- 設定ファイルを確認
- 認証情報を検証（安全な方法で）

---

## 実装レビュー

### CHK-401 [P1] 🔴 コード構造

- [ ] コードがプロジェクトの規約に従っている
- [ ] 命名が明確で一貫している
- [ ] デッドコードやコメントアウトされたブロックがない
- [ ] ファイル構成が論理的である

**検証方法**:
- コードレビュー
- linterを実行
- TODOやFIXMEを確認

---

### CHK-402 [P1] 🔴 エラーハンドリング

- [ ] すべてのエラーケースがハンドリングされている
- [ ] エラーが適切にログされている
- [ ] ユーザー向けエラーが明確である
- [ ] サイレント失敗がない

**検証方法**:
- エラーハンドリングコードをレビュー
- エラーシナリオをテスト
- ログ出力を確認

---

### CHK-403 [P2] 🟡 コード品質

- [ ] コードスメルが検出されていない
- [ ] 複雑度が妥当である
- [ ] 重複コードがない
- [ ] 関数が単一責任である

**検証方法**:
- 静的解析ツールを実行
- 循環的複雑度をレビュー
- 重複をチェック

---

## テストレビュー

### CHK-501 [P1] 🔴 ユニットテストカバレッジ

- [ ] すべてのビジネスロジックにユニットテストが存在する
- [ ] コードカバレッジ ≥ 80%
- [ ] すべての公開関数がテストされている
- [ ] エッジケースがカバーされている

**検証方法**:
```bash
npm test -- --coverage
```

**目標**: ≥80% 行カバレッジ、≥90% 分岐カバレッジ

---

### CHK-502 [P1] 🔴 統合テスト

- [ ] 統合テストがすべてのメインフローをカバーしている
- [ ] 外部サービスモックが現実的である
- [ ] データベース操作がテストされている
- [ ] APIエンドポイントがテストされている

**検証方法**:
- 統合テストスイートを実行
- テストシナリオをレビュー
- モック実装を確認

---

### CHK-503 [P1] 🔴 エッジケーステスト

- [ ] null/undefined入力がテストされている
- [ ] 空のコレクションがテストされている
- [ ] 最大/最小値がテストされている
- [ ] 並行操作がテストされている

**検証方法**:
- エッジケーステストスイートをレビュー
- 境界値テストを確認
- ストレステストを実行

---

### CHK-504 [P2] 🟡 非機能テスト

- [ ] パフォーマンステストが合格している
- [ ] 負荷テストが合格している
- [ ] セキュリティテストが合格している
- [ ] アクセシビリティテストが合格している（該当する場合）

**検証方法**:
- パフォーマンスベンチマークを実行
- 負荷テストを実行
- セキュリティスキャナーを実行

---

## ドキュメントレビュー

### CHK-601 [P2] 🟡 コードコメント

- [ ] 複雑なロジックにコメントがある
- [ ] 公開APIにJSDoc/docstringがある
- [ ] 自明でない判断が説明されている
- [ ] TODOが追跡されている（または削除されている）

**検証方法**:
- コードコメントをレビュー
- ドキュメントカバレッジを確認
- コメント品質を検証

---

### CHK-602 [P2] 🟡 設計書の更新

- [ ] 設計書が実装を反映している
- [ ] 最近の判断が文書化されている
- [ ] 図が最新である
- [ ] 変更履歴が維持されている

**検証方法**:
- `.sdd/specification/[{path}/]{feature}_design.md` をレビュー
- 実装と比較
- 最終更新日を確認

---

## セキュリティレビュー

### CHK-701 [P1] 🔴 入力検証

- [ ] すべてのユーザー入力が検証されている
- [ ] SQLインジェクション防止が実装されている
- [ ] XSS防止が実装されている
- [ ] CSRF保護が実装されている（該当する場合）

**検証方法**:
- 検証コードをレビュー
- セキュリティスキャナーを実行
- 手動ペネトレーションテスト

---

### CHK-702 [P1] 🔴 認証・認可

- [ ] 必要な場所で認証が要求されている
- [ ] 認可チェックが実装されている
- [ ] ロールベースアクセス制御が機能している
- [ ] セッション管理が安全である

**検証方法**:
- 異なるユーザーロールでテスト
- 未認可アクセス試行を確認
- 認証ミドルウェアをレビュー

---

### CHK-703 [P1] 🔴 データ保護

- [ ] 機密データが暗号化されている
- [ ] パスワードがハッシュ化されている（平文は不可）
- [ ] APIキーがハードコードされていない
- [ ] 個人情報が適切に扱われている

**検証方法**:
- 暗号化実装をレビュー
- 環境変数を確認
- データストレージを監査

---

## パフォーマンスレビュー

### CHK-801 [P2] 🟡 レスポンスタイム

- [ ] APIレスポンスタイムがNFR要件を満たしている
- [ ] データベースクエリが最適化されている
- [ ] N+1クエリ問題が回避されている
- [ ] キャッシングが適切に実装されている

**検証方法**:
- パフォーマンスプロファイリングを実行
- データベースクエリプランを確認
- キャッシング戦略をレビュー

**目標**: レスポンスタイム < 200ms（NFR-001より）

---

### CHK-802 [P3] 🟢 リソース使用量

- [ ] メモリ使用量が妥当である
- [ ] メモリリークが検出されていない
- [ ] CPU使用量が許容範囲である
- [ ] ネットワーク帯域幅が効率的である

**検証方法**:
- リソース監視を実行
- メモリ使用量をプロファイル
- 監視付きで負荷テスト

---

## デプロイレビュー

### CHK-901 [P1] 🔴 設定管理

- [ ] 環境変数が文書化されている
- [ ] 設定ファイルが正しい
- [ ] シークレットが適切に管理されている
- [ ] フィーチャーフラグが設定されている（該当する場合）

**検証方法**:
- `.env.example` をレビュー
- 設定ドキュメントを確認
- シークレット管理を検証

---

### CHK-902 [P1] 🔴 データベースマイグレーション

- [ ] マイグレーションがテストされている
- [ ] ロールバックマイグレーションが存在する
- [ ] データマイグレーションが安全である
- [ ] データ損失リスクがない

**検証方法**:
- テスト環境でマイグレーションを実行
- ロールバック処理をテスト
- マイグレーションスクリプトをレビュー

---

### CHK-903 [P1] 🔴 デプロイ計画

- [ ] デプロイ手順が文書化されている
- [ ] ロールバック計画が存在する
- [ ] 監視が設定されている
- [ ] アラートが設定されている

**検証方法**:
- デプロイドキュメントをレビュー
- ロールバック手順をテスト
- 監視ダッシュボードを検証

---

## 完了基準

### Pre-PR チェックリスト

すべてのP1（🔴 高優先度）項目が完了している必要があります：
- [ ] すべてのP1項目がチェック済み（29/29）
- [ ] すべてのテストが合格している
- [ ] 仕様の整合性を検証済み（`/check_spec`）
- [ ] コードレビュー準備完了

### Pre-Merge チェックリスト

すべてのP1とP2項目が完了している必要があります：
- [ ] すべてのP1項目がチェック済み（29/29）
- [ ] すべてのP2項目がチェック済み（24/24）
- [ ] コードレビュー承認済み
- [ ] CI/CDパイプラインが成功
- [ ] マージ準備完了

### Pre-Release チェックリスト

P3までのすべての項目が完了していることが望ましい：
- [ ] すべてのP1項目がチェック済み（29/29）
- [ ] すべてのP2項目がチェック済み（24/24）
- [ ] すべてのP3項目がチェック済み（7/7）
- [ ] QAサインオフ済み
- [ ] 本番デプロイ準備完了

---

## 注意事項

- このチェックリストは仕様書と設計書から自動生成されました
- 要件または設計が変更された場合はチェックリストを更新してください
- ガイドとして使用してください。すべての項目が適用されるとは限りません
- 必要に応じてプロジェクト固有の項目を追加してください
````

**保存先**: `.sdd/task/{チケット番号}/checklist.md`

## チェックリストテンプレート統合

このコマンドは `skills/sdd-templates/templates/checklist_template.md` のテンプレートをベースとして使用し、以下に基づいてカスタマイズします：

- プロジェクト固有の要件
- プログラミング言語の規約
- 技術スタック
- チーム標準

## 既存チェックリストの更新

仕様変更後に既存のチェックリストを更新するには：

```
/checklist user-auth TICKET-123 --update
```

以下を実行します：

1. 既存のチェックリストを読み込む
2. 現在の仕様と比較
3. 新しい項目を追加
4. 廃止された項目をマーク
5. 完了状態を保持

## エクスポート形式

### GitHub Issues

```
/checklist user-auth TICKET-123 --export github-issues
```

P0項目を個別のGitHub Issueとして作成します。

### Notion/Linear

```
/checklist user-auth TICKET-123 --export csv
```

チェックリストをCSVとしてエクスポートし、プロジェクト管理ツールにインポートできます。

## ベストプラクティス

| プラクティス     | メリット                    |
|:-----------|:------------------------|
| **早期生成**   | チェックリストを実装ガイドとして活用      |
| **定期更新**   | 仕様変更と同期を保つ              |
| **完了追跡**   | 検証済み項目をマーク              |
| **カスタマイズ** | プロジェクト固有の項目を追加          |
| **アーカイブ**  | 将来の参照用に実装と一緒にチェックリストを保管 |

## 他コマンドとの連携

```
/generate_spec {機能名}
   ↓
/task_breakdown {機能名}
   ↓
/checklist {機能名} {チケット番号}  ← チェックリスト生成
   ↓
/implement {機能名} {チケット番号}  ← 実装中にチェックリスト使用
   ↓
PR作成前にチェックリストと照合
```

## 注意事項

- チェックリスト項目は仕様から派生したもので、独自に作成されたものではない
- ID（CHK-101、CHK-201等）は更新間で安定しており、カテゴリ別に整理されている
- 優先度レベル（P1 🔴、P2 🟡、P3 🟢）はプロジェクトごとにカスタマイズ可能
- 一部の項目は手動検証が必要な場合がある
- 自動チェックは可能な限りCI/CDに統合すべき
- 将来の参照用にチェックリストをタスクログと一緒にアーカイブする
