---
description: "旧バージョン（v1.x）のAI-SDDディレクトリ構成を新バージョン（v2.0.0）に移行する。"
allowed-tools: Read, Write, Edit, Glob, Grep, Bash, AskUserQuestion
---

# SDD Migrate - AI-SDDマイグレーション

旧バージョン（v1.x）のAI-SDDディレクトリ構成を新バージョン（v2.0.0）に移行するためのコマンドです。

## このコマンドの機能

1. **構成検出**: 現在のディレクトリ構成を自動検出
2. **移行オプション提示**: 新構成への移行または互換性設定の生成を選択
3. **安全な移行**: Git管理下でのリネームまたは設定ファイル生成

## 破壊的変更の概要（v1.x → v2.0.0）

| 旧構成（v1.x）              | 新構成（v2.0.0）     | 説明            |
|:-----------------------|:----------------|:--------------|
| `.docs/`               | `.sdd/`         | ルートディレクトリ     |
| `requirement-diagram/` | `requirement/`  | 要求仕様書格納ディレクトリ |
| `review/`              | `task/`         | タスクログ格納ディレクトリ |
| `/review_cleanup`      | `/task_cleanup` | クリーンアップコマンド   |

## 実行フロー

```
1. 現在のディレクトリ構成を検出
   ├─ .docs/ が存在するか？
   ├─ requirement-diagram/ が存在するか？
   └─ review/ が存在するか？
   ↓
2. 検出結果を表示
   ├─ 旧構成が検出された場合: 移行オプションを提示
   └─ 新構成または設定済みの場合: 移行不要を通知
   ↓
3. ユーザーに選択肢を提示
   ├─ A: 新構成に移行（ディレクトリをリネーム）
   └─ B: 旧構成を維持（.sdd-config.json を生成）
   ↓
4. 選択に応じて処理を実行
   ├─ A: git mv でディレクトリをリネーム
   └─ B: .sdd-config.json を生成
   ↓
5. CLAUDE.md の更新（必要な場合）
   ↓
6. 移行完了レポートを表示
```

## 選択肢の詳細

### オプションA: 新構成に移行

**推奨**: プロジェクトが初期段階の場合や、統一された命名規則を使いたい場合

処理内容:

1. `git mv .docs .sdd` でルートディレクトリをリネーム
2. `git mv .sdd/requirement-diagram .sdd/requirement` で要求仕様ディレクトリをリネーム
3. `git mv .sdd/review .sdd/task` でタスクディレクトリをリネーム
4. CLAUDE.md 内のパス参照を更新
5. 変更をコミット

**利点**:

- 新しいプラグインバージョンと完全に互換
- ドキュメント参照がシンプルに

**注意**:

- 既存の参照やスクリプトの更新が必要な場合がある
- Git履歴でリネームとして追跡される

### オプションB: 旧構成を維持

**推奨**: 既存のプロジェクトで多くの参照がある場合や、破壊的変更を避けたい場合

処理内容:

1. `.sdd-config.json` を生成し、旧ディレクトリ名を設定
2. プラグインは設定ファイルに基づいて動作

**生成される設定ファイル例**:

```json
{
  "root": ".docs",
  "directories": {
    "requirement": "requirement-diagram",
    "specification": "specification",
    "task": "review"
  }
}
```

**利点**:

- 既存の構成を変更しない
- 既存の参照やスクリプトがそのまま動作

**注意**:

- 新しいドキュメントでは旧ディレクトリ名が使用される
- 設定ファイルの管理が必要

## 検出ロジック

以下の条件で旧構成を検出:

1. **旧ルートディレクトリ**: `.docs/` が存在し、`.sdd/` が存在しない
2. **旧要求仕様ディレクトリ**: `{root}/requirement-diagram/` が存在
3. **旧タスクディレクトリ**: `{root}/review/` が存在し、`{root}/task/` が存在しない

## 出力例

### 旧構成が検出された場合

````markdown
## AI-SDD マイグレーション

### 検出された構成

| 項目 | 現在の値 | 新しい推奨値 |
|:---|:---|:---|
| ルートディレクトリ | `.docs` | `.sdd` |
| 要求仕様ディレクトリ | `requirement-diagram` | `requirement` |
| タスクディレクトリ | `review` | `task` |

### 移行オプション

**A: 新構成に移行**

- ディレクトリをリネームして新しい命名規則に統一
- 推奨: 新規プロジェクトや初期段階のプロジェクト

**B: 旧構成を維持**

- `.sdd-config.json` を生成して現在の構成を維持
- 推奨: 多くの外部参照がある既存プロジェクト

どちらのオプションを選択しますか？
````

### 移行完了後（オプションA選択時）

````markdown
## マイグレーション完了

### 実行された変更

- [x] `.docs/` → `.sdd/` にリネーム
- [x] `requirement-diagram/` → `requirement/` にリネーム
- [x] `review/` → `task/` にリネーム
- [x] CLAUDE.md のパス参照を更新

### 次のステップ

1. 既存のスクリプトや参照を確認し、必要に応じて更新
2. `git status` で変更を確認
3. 変更をコミット（推奨メッセージ: `[docs] AI-SDD v2.0.0 構成に移行`）
````

### 移行完了後（オプションB選択時）

````markdown
## マイグレーション完了

### 生成されたファイル

- [x] `.sdd-config.json` を作成

### 設定内容

```json
{
  "root": ".docs",
  "directories": {
    "requirement": "requirement-diagram",
    "specification": "specification",
    "task": "review"
  }
}
```

### 次のステップ

1. `.sdd-config.json` をバージョン管理に追加
2. 変更をコミット（推奨メッセージ: `[docs] AI-SDD 互換性設定を追加`）

````

## エラーハンドリング

### Git管理外のプロジェクト

```

⚠️ このプロジェクトはGit管理下にありません。

オプションA（ディレクトリリネーム）を選択する場合、
手動でのバックアップを推奨します。

続行しますか？

```

### 既に新構成の場合

```

✅ このプロジェクトは既に新しい構成を使用しています。

マイグレーションは不要です。

現在の構成:

- ルートディレクトリ: .sdd
- 要求仕様: requirement
- タスク: task

```

### .sdd-config.json が既に存在する場合

```

ℹ️ `.sdd-config.json` が既に存在します。

現在の設定:

- root: {現在の値}
- directories.requirement: {現在の値}
- directories.task: {現在の値}

この設定に基づいてプラグインは動作します。
設定を変更する場合は、手動で `.sdd-config.json` を編集してください。

```

## コミット

移行完了後:

### オプションAの場合

```

[docs] AI-SDD v2.0.0 構成に移行

- .docs/ → .sdd/ にリネーム
- requirement-diagram/ → requirement/ にリネーム
- review/ → task/ にリネーム

```

### オプションBの場合

```

[docs] AI-SDD 互換性設定を追加

- .sdd-config.json を生成
- 旧ディレクトリ構成を維持

```
