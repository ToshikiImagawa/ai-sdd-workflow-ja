# 実装ログ: {機能名}

## メタ情報

| 項目     | 内容                                             |
|:-------|:-----------------------------------------------|
| 機能名    | {機能名}                                          |
| チケット番号 | {チケット番号}                                       |
| 対象設計書  | `.sdd/specification/[{path}/]{name}_design.md` |
| 実装開始日  | YYYY-MM-DD                                     |
| 実装完了日  | YYYY-MM-DD                                     |
| 実装者    | {実装者名}                                         |

※ 階層構造の場合、親機能は `index_design.md`

## 概要

{この実装の概要を簡潔に記述}

---

## 進捗サマリー

| フェーズ          | ステータス | 完了タスク | 開始日        | 完了日        |
|:--------------|:------|:------|:-----------|:-----------|
| Phase 1: 基盤構築 | ✓ 完了  | 3/3   | YYYY-MM-DD | YYYY-MM-DD |
| Phase 2: コア実装 | 進行中   | 2/5   | YYYY-MM-DD | -          |
| Phase 3: 統合   | 未着手   | 0/2   | -          | -          |
| Phase 4: テスト  | 未着手   | 0/4   | -          | -          |
| Phase 5: 仕上げ  | 未着手   | 0/2   | -          | -          |

**全体進捗**: {n}/{total} タスク ({percentage}%)

---

## 日次ログ

### YYYY-MM-DD - セッション {n}

**時間**: HH:MM - HH:MM
**作業内容**: {作業した内容}

#### 完了したタスク

- [x] タスク 1.1: ディレクトリ設定
    - モジュール構造を作成
    - テストインフラストラクチャを設定
    - コミット: `abc123`, `def456`

#### 進捗状況

**タスク 2.1: ユーザーバリデーション**

- Zodスキーマを実装
- 8つのユニットテストを追加（すべて成功）
- メール正規化のエッジケースを発見

#### 設計判断

**判断**: バリデーションライブラリとしてZodを採用
**理由**:

- TypeScript統合が優れている
- バンドルサイズが小さい
- メンテナンスがより活発
  **検討した代替案**: Joi, Yup
  **影響範囲**: バリデーション層、API入力処理

#### 遭遇した課題

**課題**: メールバリデーションのエッジケース
**問題**: Unicodeメールアドレスが処理されない
**解決策**: バリデーション前にpunycodeエンコーディングを追加
**参考**: RFC 6531 (SMTPUTF8)
**時間的影響**: +1時間

#### 追加したテスト

- `user-validation.test.ts`: 8テスト
    - 有効なユーザー入力（4テスト）
    - 無効な入力（3テスト）
    - エッジケース（1テスト）
- すべてのテストが成功 ✓

#### 仕様との整合性

- [x] API仕様と一致
- [x] データモデルと一致
- [x] `*_design.md` の設計判断に従っている

#### コミット

```
abc123 - test: ユーザーバリデーションテストを追加
def456 - feat: Zodを使用したユーザーバリデーションを実装
ghi789 - refactor: メール正規化ロジックを抽出
```

#### 次のステップ

- [ ] タスク 2.2: データ永続化の完了
- [ ] バリデーション + 永続化の統合テストを追加
- [ ] Zod採用の判断を設計書に反映

---

### YYYY-MM-DD - セッション {n+1}

**時間**: HH:MM - HH:MM
**作業内容**: {作業した内容}

{上記と同じ構造を繰り返す}

---

## フェーズ完了サマリー

### Phase 1: 基盤構築 - 完了

**所要時間**: {n} 時間
**タスク**: 3/3
**追加したテスト**: {n}
**コミット数**: {n}

**主な成果**:

- プロジェクト構造を確立
- テストインフラストラクチャを設定
- コア型を定義

**設計判断**:

- なし（設計書に従った）

**課題**:

- 重大な課題なし

---

### Phase 2: コア実装 - 進行中

**所要時間**: {n} 時間（現時点）
**タスク**: 2/5
**追加したテスト**: {n}
**コミット数**: {n}

**主な成果**:

- ユーザーバリデーションを実装
- データ永続化層を設定

**設計判断**:

- バリデーションにZodを採用（上記参照）

**課題**:

- メールバリデーションのエッジケース（解決済み）

**残タスク**:

- タスク 2.3, 2.4, 2.5
- 既存認証システムとの統合
- エラーハンドリングの改善

---

## 実装判断

設計書に記載されていない実装上の判断を記録します。

### {判断事項1}

**日時**: YYYY-MM-DD HH:MM

**状況**: {どのような状況で判断が必要になったか}

**選択肢**:

1. {選択肢A}: {メリット/デメリット}
2. {選択肢B}: {メリット/デメリット}
3. {選択肢C}: {メリット/デメリット}

**決定**: {選択した選択肢}

**理由**: {選択した理由}

**影響範囲**: {この判断が影響するモジュール・機能}

**設計書への反映**: {反映する/反映しない}（理由: {理由}）

---

### {判断事項2}

**日時**: YYYY-MM-DD HH:MM

**状況**: {状況}

**選択肢**:

1. {選択肢A}
2. {選択肢B}

**決定**: {決定内容}

**理由**: {理由}

**影響範囲**: {影響範囲}

**設計書への反映**: {反映する/反映しない}

---

## 問題と解決策

実装中に遭遇した問題とその解決方法を記録します。

### {問題1}

**日時**: YYYY-MM-DD HH:MM

**問題**: {遭遇した問題の詳細}

**原因**: {問題の原因}

**試行した解決策**:

1. {試行1}: {結果}
2. {試行2}: {結果}
3. {試行3}: {結果}

**最終的な解決策**: {採用した解決策}

**根本原因**: {根本的な原因分析}

**再発防止策**: {同様の問題を防ぐための対策}

**設計書への反映**: {反映する/反映しない}（理由: {理由}）

---

### {問題2}

**日時**: YYYY-MM-DD HH:MM

**問題**: {問題}

**解決策**: {解決策}

**設計書への反映**: {反映する/反映しない}

---

## 設計判断サマリー

実装中に行われたすべての設計判断:

### DD-001: バリデーションライブラリの選定

**日付**: YYYY-MM-DD
**判断**: 入力バリデーションにZodを使用
**理由**: TypeScript統合が優れている、バンドルサイズが小さい
**代替案**: Joi, Yup
**ステータス**: タスク 2.1 で実装済み
**ドキュメント化**: `*_design.md` の「技術スタック」セクションに追加

### DD-002: {次の判断}

{追加の判断のテンプレート}

---

## 技術的負債

将来の作業が必要なショートカットを記録:

### TD-001: メールバリデーションのパフォーマンス

**問題**: 現在のpunycodeエンコーディングは1回のバリデーションあたり約5ms追加
**影響**: 単一リクエストでは軽微、バルク操作では影響の可能性
**対策**: v1では許容範囲、v2で最適化
**追跡**: Issue #{issue-number}

---

## 仕様書更新が必要な項目

実装中の発見に基づき、仕様書の更新が必要な項目を記録:

### SU-001: メール正規化が未指定

**ドキュメント**: `*_spec.md`
**セクション**: データモデル § User
**必要な更新**: メール正規化（punycode）に関する注記を追加
**優先度**: 中
**ステータス**: 保留中

---

## テストサマリー

### ユニットテスト

| モジュール            | テスト数 | カバレッジ | ステータス    |
|:-----------------|:-----|:------|:---------|
| user-validation  | 8    | 95%   | ✓ 成功     |
| data-persistence | 12   | 87%   | ✓ 成功     |
| {module}         | {n}  | {n}%  | {status} |

**総ユニットテスト数**: {n}
**全体カバレッジ**: {n}%

### 統合テスト

| テストスイート   | テスト数 | ステータス    |
|:----------|:-----|:---------|
| auth-flow | 5    | ✓ 成功     |
| {suite}   | {n}  | {status} |

**総統合テスト数**: {n}

### エッジケーステスト

| シナリオ       | ステータス    | 備考               |
|:-----------|:---------|:-----------------|
| Nullユーザー入力 | ✓ 成功     | 適切に拒否            |
| 空のメール      | ✓ 成功     | バリデーションエラー       |
| Unicodeメール | ✓ 成功     | Punycodeエンコーディング |
| {scenario} | {status} | {notes}          |

---

## パフォーマンス指標

実装中のパフォーマンスを追跡:

| 操作          | 目標       | 実測値      | ステータス    |
|:------------|:---------|:---------|:---------|
| ユーザーバリデーション | < 10ms   | 7ms      | ✓ 達成     |
| データベース挿入    | < 50ms   | 32ms     | ✓ 達成     |
| {operation} | {target} | {actual} | {status} |

---

## ブロッカーと依存関係

### 現在のブロッカー

現在なし。

### 解決済みブロッカー

**B-001**: ZodのTypeScript型定義

- **影響**: バリデーションロジックがコンパイルできない
- **解決**: `@types/zod` を最新バージョンに更新
- **解決日**: YYYY-MM-DD
- **失った時間**: 30分

### 外部依存関係

| 依存関係         | ステータス | ETA    | 影響            |
|:-------------|:------|:-------|:--------------|
| 認証サービスAPIの更新 | 待機中   | 次スプリント | タスク 3.1 をブロック |

---

## コードレビューフィードバック

実装中に受けたフィードバックを記録:

### レビューラウンド 1 (PR #{n})

**レビュアー**: {名前}
**日付**: YYYY-MM-DD

**フィードバック**:

1. メール正規化を別のユーティリティに抽出
    - **ステータス**: ✓ コミット `ghi789` で対応
2. バリデーション関数にJSDocを追加
    - **ステータス**: ✓ コミット `jkl012` で対応
3. バリデーションスキーマのキャッシュを検討
    - **ステータス**: パフォーマンス最適化フェーズに延期

---

## 統合ノート

この機能が既存システムとどのように統合されるかに関するノート:

### {システム名} との統合

- {統合ポイント 1}
- {統合ポイント 2}
- {互換性に関する注記}

---

## ドキュメント更新

更新が必要なドキュメントを記録:

- [x] `*_design.md` にZodの判断を反映
- [x] 新しいエンドポイントでAPIドキュメントを更新
- [ ] 新しい環境変数でREADMEを更新
- [ ] バリデーションアプローチのADRを追加

---

## 得られた教訓

実装中に得られた洞察:

### うまくいったこと

- TDDアプローチによりエッジケースを早期に発見
- 明確な仕様により実装が直感的に
- Zod統合が予想以上にスムーズ

### 改善できること

- メールのエッジケースは元の仕様に含めるべきだった
- パフォーマンステストをより早く開始すべき
- スキーマバリデーションのためのより良いツールが必要

### 次回に向けて

- 仕様テンプレートにメールフォーマットの例を追加
- PRDにパフォーマンス要件を含める
- 最初からバリデーションベンチマークを設定

---

## 最終チェックリスト（完了時）

### 実装

- [ ] すべてのタスクが完了
- [ ] すべてのテストが成功
- [ ] コードレビュー済み・承認済み
- [ ] マージコンフリクトなし

### ドキュメント

- [ ] 設計書を判断で更新
- [ ] APIドキュメントが最新
- [ ] コードコメントを追加
- [ ] 必要に応じてREADMEを更新

### 品質

- [ ] カバレッジ ≥ 80%
- [ ] パフォーマンスベンチマークが合格
- [ ] セキュリティレビュー完了
- [ ] 仕様との整合性を検証（`/check_spec`）

### クリーンアップ

- [ ] 技術的負債を記録
- [ ] 一時ファイルを削除
- [ ] デバッグコードを削除
- [ ] タスクログをクリーンアップ準備

---

## 代替案の検討

採用しなかった代替案とその理由を記録します。

### {機能/モジュール名}の実装アプローチ

**採用したアプローチ**: {採用したアプローチ}

**検討した代替案**:

#### 代替案A: {名前}

**概要**: {代替案の概要}

**メリット**:

- {メリット1}
- {メリット2}

**デメリット**:

- {デメリット1}
- {デメリット2}

**不採用の理由**: {なぜ採用しなかったか}

---

#### 代替案B: {名前}

**概要**: {概要}

**メリット**:

- {メリット}

**デメリット**:

- {デメリット}

**不採用の理由**: {理由}

---

## 技術的発見

実装中に得られた知見や学習事項を記録します。

### {発見事項1}

**日時**: YYYY-MM-DD HH:MM

**発見内容**: {発見した技術的な知見}

**背景**: {どのような状況で発見したか}

**実装への影響**: {この発見が実装にどう影響したか}

**将来への応用**: {今後の開発にどう活かせるか}

**設計書への反映**: {反映する/反映しない}

---

### {発見事項2}

**日時**: YYYY-MM-DD HH:MM

**発見内容**: {発見内容}

**実装への影響**: {影響}

---

## テスト結果

実装したテストの実行結果を記録します。

### Phase 2: Tests（テスト先行）

**実行日時**: YYYY-MM-DD HH:MM

**テストケース数**: {n} 件

**結果**: ✅ すべて失敗（Red）

**詳細**:

| テストケース    | 結果         | 備考            |
|:----------|:-----------|:--------------|
| {テストケース1} | ❌ 失敗（期待通り） | 実装前のため失敗（Red） |
| {テストケース2} | ❌ 失敗（期待通り） | 実装前のため失敗（Red） |

---

### Phase 3: Core（コア実装）

**実行日時**: YYYY-MM-DD HH:MM

**テストケース数**: {n} 件

**結果**: ✅ すべて成功（Green）

**詳細**:

| テストケース    | 結果   | 備考                  |
|:----------|:-----|:--------------------|
| {テストケース1} | ✅ 成功 | 実装完了後、テストが成功（Green） |
| {テストケース2} | ✅ 成功 | 実装完了後、テストが成功（Green） |

**テストカバレッジ**:

- ステートメントカバレッジ: {n}%
- ブランチカバレッジ: {n}%
- 関数カバレッジ: {n}%

---

### Phase 4: Integration（統合）

**実行日時**: YYYY-MM-DD HH:MM

**統合テストケース数**: {n} 件

**結果**: ✅ すべて成功

**詳細**:

| テストケース   | 結果   | 備考             |
|:---------|:-----|:---------------|
| {統合テスト1} | ✅ 成功 | モジュール間連携が正常に動作 |
| {統合テスト2} | ✅ 成功 | 外部システム連携が正常に動作 |

---

### 最終テスト結果

**実行日時**: YYYY-MM-DD HH:MM

**総テストケース数**: {n} 件

**結果**: ✅ すべて成功

**テストカバレッジ**:

- ステートメントカバレッジ: {n}%
- ブランチカバレッジ: {n}%
- 関数カバレッジ: {n}%

**目標達成状況**:

- [x] テストカバレッジ > 80%
- [x] すべてのエッジケースにテストが存在
- [x] すべてのテストが成功

---

## パフォーマンス計測

非機能要件で定義されたパフォーマンス目標の達成状況を記録します。

### {処理名1}

**目標**: 95%ile < {目標値}ms

**計測結果**:

- 平均: {n}ms
- 95%ile: {n}ms
- 99%ile: {n}ms

**達成状況**: ✅ 達成 / ❌ 未達成

**備考**: {備考}

---

### {処理名2}

**目標**: {目標}

**計測結果**: {結果}

**達成状況**: ✅ / ❌

---

## 設計書への統合内容

実装完了後、このログから設計書に統合すべき内容をマークします。

### 統合する内容

- [ ] **実装判断**: {判断事項1} → `*_design.md` の「設計判断」セクションに追記
- [ ] **技術的発見**: {発見事項1} → `*_design.md` の「技術スタック」セクションに反映
- [ ] **代替案**: {代替案の検討} → `*_design.md` の「設計判断」セクションに追記

### 統合しない内容（削除可能）

- 一時的な調査ログ
- 作業進捗メモ
- デバッグログ

---

## タイムライン

実装の時系列記録。

| 日時               | イベント       | 備考                |
|:-----------------|:-----------|:------------------|
| YYYY-MM-DD 10:00 | Phase 1 開始 | 基盤構築              |
| YYYY-MM-DD 11:30 | Phase 1 完了 | ディレクトリ構成、型定義完了    |
| YYYY-MM-DD 12:00 | Phase 2 開始 | テストケース作成開始        |
| YYYY-MM-DD 14:00 | Phase 2 完了 | すべてのテストが失敗（Red）   |
| YYYY-MM-DD 14:30 | Phase 3 開始 | コア実装開始            |
| YYYY-MM-DD 17:00 | {問題1}に遭遇   | {問題の概要}           |
| YYYY-MM-DD 17:30 | {問題1}を解決   | {解決策}             |
| YYYY-MM-DD 18:00 | Phase 3 完了 | すべてのテストが成功（Green） |
| YYYY-MM-DD 18:15 | Phase 4 開始 | 統合テスト作成開始         |
| YYYY-MM-DD 19:00 | Phase 4 完了 | 統合テスト成功           |
| YYYY-MM-DD 19:15 | Phase 5 開始 | リファクタリング開始        |
| YYYY-MM-DD 20:00 | Phase 5 完了 | 実装完了              |

**総実装時間**: {n}時間

---

## 次のアクション

- [ ] 設計書（`*_design.md`）に重要な実装判断を統合
- [ ] `/check_spec` で仕様との整合性を検証
- [ ] `/task_cleanup` でタスクログをクリーンアップ
- [ ] このログを削除（設計書への統合完了後）

---

## 参照ドキュメント

- 設計書: `.sdd/specification/[{path}/]{name}_design.md`
- 抽象仕様書: `.sdd/specification/[{path}/]{name}_spec.md`
- タスクリスト: `.sdd/task/{チケット番号}/tasks.md`

※ 階層構造の場合、親機能は `index_spec.md`、`index_design.md`
