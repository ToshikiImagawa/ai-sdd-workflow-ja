---
name: vibe-detector
description: "ユーザーの入力を分析し、Vibe Coding（曖昧な指示）を自動検出してリスク評価を行います。曖昧な実装指示や仕様不足を検出した場合に使用します。"
allowed-tools: Read, Glob, Grep, AskUserQuestion
---

# Vibe Detector - 曖昧な指示の自動検出

ユーザーの入力を分析し、Vibe Coding（曖昧な指示によりAIが未定義要件を推測せざるを得ない問題）を検出します。

## 前提条件

**実行前に必ず `sdd-workflow-ja:sdd-workflow` エージェントの内容を読み込み、AI-SDDの原則を理解してください。**

このスキルはsdd-workflowエージェントの原則に従ってVibe Codingを検出します。

## 検出パターン

### 曖昧な指示

| パターン        | 例                       |
|:------------|:------------------------|
| **主観的表現**   | 「いい感じに」「適当に」「うまく」「きれいに」 |
| **程度の不明確さ** | 「もっと速く」「少し改善」「だいたい動けば」  |
| **範囲の曖昧さ**  | 「あの機能」「前のやつ」「いつもの」      |
| **暗黙の前提**   | 「前と同じように」「いつも通りに」「当然〜」  |
| **優先度の曖昧さ** | 「できれば」「余裕があれば」「ついでに」    |

### 仕様の欠如

| パターン          | 例                  |
|:--------------|:-------------------|
| **要件の不足**     | 「〜機能を作って」（詳細なし）    |
| **入出力の未定義**   | 引数、戻り値、エラーケースの記載なし |
| **境界条件の不明**   | 最大値、最小値、エッジケースの未定義 |
| **エラー処理の未定義** | 異常系の動作が不明          |

### 範囲の不明確さ

| パターン        | 例                        |
|:------------|:-------------------------|
| **対象の曖昧さ**  | 「パフォーマンスを改善」（どこの？何を基準に？） |
| **影響範囲の不明** | 「リファクタリング」（どの範囲？）        |
| **完了条件の欠如** | いつ完了とするかが不明              |

## リスク評価基準

| レベル      | 条件              | 対応                  |
|:---------|:----------------|:--------------------|
| 🔴 **高** | 仕様書なし + 曖昧な指示   | 実装前に仕様書作成を**必須**とする |
| 🟡 **中** | 仕様書あり + 曖昧な部分あり | 曖昧な箇所を明確化してから実装     |
| 🟢 **低** | 仕様書あり + 要件明確    | 実装を開始可能             |

## 検出時の対応フロー

```
1. 曖昧な箇所を特定
   ↓
2. リスクレベルを判定
   ↓
3. ユーザーに確認・明確化を依頼
   ├─ 明確化された → 実装に進む
   └─ 拒否された → 4へ
   ↓
4. 仕様書の作成/更新を提案
   ├─ 承諾された → 仕様書作成後に実装
   └─ 拒否された → 5へ
   ↓
5. リスクを明示的に警告
   ↓
6. 推測した仕様を review/ に記録
   ↓
7. 検証ポイントを設定して実装
```

## 出力フォーマット

```markdown
## ⚠️ Vibe Coding リスク検出

### リスクレベル: 🔴 高 / 🟡 中 / 🟢 低

### 検出された曖昧な指示

| # | 箇所 | パターン | 問題点 |
|:---|:---|:---|:---|
| 1 | 「{該当箇所}」 | {パターン名} | {具体的な問題点} |
| 2 | 「{該当箇所}」 | {パターン名} | {具体的な問題点} |

### 明確化が必要な項目

- [ ] {質問1}
- [ ] {質問2}
- [ ] {質問3}

### 仕様書の状況

| ドキュメント | ステータス |
|:---|:---|
| PRD | 🟢 存在 / 🔴 なし |
| *_spec.md | 🟢 存在 / 🔴 なし |
| *_design.md | 🟢 存在 / 🔴 なし |

### 推奨アクション

**🔴 高リスクの場合**:

1. 上記の明確化項目についてユーザーに確認
2. `/generate_spec` で仕様書を作成
3. 仕様書をレビュー後に実装開始

**🟡 中リスクの場合**:

1. 曖昧な箇所についてユーザーに確認
2. 必要に応じて仕様書を更新
3. 実装開始

**🟢 低リスクの場合**:

- 実装を開始可能
```

## 仕様不足時のエスカレーション

ユーザーが仕様書作成を拒否した場合でも、以下の最低限のガードレールを確保：

### 1. 推測仕様の明文化

```markdown
# 推測仕様書

## 警告

この仕様は明示的な要件定義なしに推測されたものです。
実装完了後にユーザーとの検証が必要です。

## 推測した仕様

| 項目 | 推測内容 | 確信度 |
|:---|:---|:---|
| {項目1} | {推測内容} | 高 / 中 / 低 |
| {項目2} | {推測内容} | 高 / 中 / 低 |

## 検証ポイント

- [ ] {実装完了時に確認すべき項目1}
- [ ] {実装完了時に確認すべき項目2}

## 潜在的リスク

- {仕様不足による潜在的な問題1}
- {仕様不足による潜在的な問題2}
```

**保存先**: `.docs/review/{ticket}/assumed-spec.md`

### 2. 検証ポイントの設定

実装完了時にユーザーと確認すべき項目をリスト化：

- 推測した仕様が意図と一致しているか
- エッジケースの動作が期待通りか
- 非機能要件（パフォーマンス等）が満たされているか

### 3. リスクの可視化

仕様不足による潜在的な問題を明示：

- 再実装のリスク
- バグ混入のリスク
- 技術的負債の蓄積リスク

## 注意事項

- このスキルは**検出と警告**を行うもので、実装をブロックするものではない
- 最終的な判断はユーザーに委ねる
- 警告を無視して実装する場合は、必ず推測仕様を記録する
- 検出精度を高めるため、プロジェクトの既存仕様書も参照する
